/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package weatherplantwater;


import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStreamReader;
import java.net.URL;
import java.net.URLConnection;
import java.util.List;
import java.util.Map;

import org.junit.Test;
import static org.junit.Assert.*;

/**
 *
 * @author Kelsey
 */
public class WeatherPlantWaterTest {
    
    //apiHandlerTests
    
    @Test
    public void testapihandleroutputk() {
        try{
        String result = "";
              URL url = new URL("http://api.openweathermap.org/data/2.5/weather?q=fresno,us&appid=14bc3c13c84f557708d9ecc439e10171&units=imperial");
              URLConnection conn = url.openConnection();
              try (BufferedReader rd = new BufferedReader(new InputStreamReader (conn.getInputStream()))) {
                  String line;
                  while ((line = rd.readLine()) != null){
                      result.concat(line);
                  }
              }
              int count=0;
              int index=0;
              while(count<13){
                  if(result.charAt(index)=='"'){
                      count++;
                  }
                  index++;
              }
              String finl="";
              while(result.charAt(index)!='"'){
                  finl.concat(Character.toString(result.charAt(index)));
                  index++;
              }
              System.out.println("finl");
              assertEquals(finl, "Clouds");
        }
        catch(Exception e){
            System.out.println(e.getMessage());
        }
    }
    
    
    
    
    //bad url/null test
    @Test
    public void testbadURLAPIreturn() {
        String urlString = "badURL";
        int k;
        int numErrors = 0;
        
        try{
        
              StringBuilder result = new StringBuilder();
              URL url = new URL(urlString);
              URLConnection conn = url.openConnection();
              try (BufferedReader rd = new BufferedReader(new InputStreamReader (conn.getInputStream()))) {
                  String line;
                  while ((line = rd.readLine()) != null){
                      result.append(line);
                  }
              }
              
        numErrors++;      
              
          Map<String, Object > respMap = WeatherPlantWater.jsonToMap(result.toString());
          Map<String, Object > mainMap = (Map<String, Object >)respMap.get("main");
          Map<String, Object > sysMap = (Map<String, Object >)respMap.get("sys");
          String  nameMap = (String) respMap.get("name");
          List<Map<String, Object >> weather = (List<Map<String, Object>>) (respMap.get("weather"));
          Map<String, Object> weatherMap = weather.get(0);
          
         WeatherPlantWater.CityLabel.setText("City: " + nameMap); 
         WeatherPlantWater.CountryLabel.setText("Country: " + sysMap.get("country"));         
         WeatherPlantWater.WeatherDescriptionLabel.setText("Weather Description: "+ weatherMap.get("main"));          
         WeatherPlantWater.TemperatureLabel.setText("Current Temperature: " + mainMap.get("temp") +" F" );
         
         //use weather input to conver to  range of index from 0-1, depending on weather conditions
         Object description =  weatherMap.get("main");
        if (description.equals("Thunderstorm") || description.equals("Snow")||description.equals("Rain") || description.equals("Drizzle") ){
            k=1;
        }            
        else{
            k=0;
        }
 
          }catch (IOException e){
              assertEquals(numErrors, 0);
              System.out.println(e.getMessage());
          }
      
    }
    
    @Test
    public void test() {
        
    }
    @Test
    public void testAPIWeathercondition() {
        
    }
    
    //WeatherPlantWaterTests
    
    
}



